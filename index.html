<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PollStation üó≥Ô∏è</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0f0f13;
      --surface: #1a1a24;
      --border: #2e2e42;
      --accent: #7c5cfc;
      --accent2: #3ecfcf;
      --text: #e8e8f0;
      --muted: #7070a0;
      --success: #34d68c;
      --danger: #f05575;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', system-ui, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
      width: 100%;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 18px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    header h1 {
      font-size: 1.4rem;
      font-weight: 700;
      letter-spacing: -0.5px;
    }

    header h1 span { color: var(--accent); }

    .badge {
      font-size: 0.7rem;
      background: var(--accent);
      color: #fff;
      border-radius: 999px;
      padding: 3px 10px;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .peer-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: var(--success);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    main {
      width: 100%;
      max-width: 900px;
      padding: 36px 24px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 28px;
    }

    @media (max-width: 640px) {
      main { grid-template-columns: 1fr; }
    }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
    }

    .card h2 {
      font-size: 1rem;
      font-weight: 600;
      color: var(--accent2);
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card h2 .icon { font-size: 1.2rem; }

    input, textarea {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      padding: 10px 14px;
      font-size: 0.9rem;
      margin-bottom: 10px;
      outline: none;
      transition: border-color 0.2s;
    }

    input:focus, textarea:focus {
      border-color: var(--accent);
    }

    textarea { resize: vertical; min-height: 70px; }

    .choices-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 14px;
    }

    button {
      cursor: pointer;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.88rem;
      padding: 10px 20px;
      transition: opacity 0.15s, transform 0.1s;
    }

    button:active { transform: scale(0.97); }
    button:hover { opacity: 0.9; }

    .btn-primary {
      background: var(--accent);
      color: #fff;
      width: 100%;
    }

    .btn-secondary {
      background: var(--border);
      color: var(--text);
      width: 100%;
      margin-bottom: 8px;
    }

    /* Poll display */
    .poll-card {
      grid-column: 1 / -1;
    }

    .poll-question {
      font-size: 1.15rem;
      font-weight: 700;
      margin-bottom: 20px;
      line-height: 1.4;
    }

    .choice-row {
      margin-bottom: 12px;
    }

    .choice-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      margin-bottom: 5px;
      color: var(--text);
    }

    .choice-label .pct {
      color: var(--muted);
      font-weight: 500;
    }

    .bar-bg {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 999px;
      height: 10px;
      overflow: hidden;
    }

    .bar-fill {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      transition: width 0.6s cubic-bezier(0.4,0,0.2,1);
    }

    .vote-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 20px;
    }

    .vote-btn {
      background: var(--bg);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 9px 12px;
      border-radius: 8px;
      font-size: 0.82rem;
      font-weight: 500;
      transition: border-color 0.2s, background 0.2s;
    }

    .vote-btn:hover {
      border-color: var(--accent);
      background: rgba(124, 92, 252, 0.1);
    }

    .vote-btn.voted {
      border-color: var(--success);
      color: var(--success);
      background: rgba(52, 214, 140, 0.1);
    }

    .stats-row {
      display: flex;
      gap: 20px;
      margin-top: 18px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
      font-size: 0.8rem;
      color: var(--muted);
    }

    .stat strong { color: var(--text); }

    /* Activity log */
    .log {
      max-height: 180px;
      overflow-y: auto;
      font-size: 0.78rem;
      color: var(--muted);
      line-height: 1.6;
    }

    .log-entry { margin-bottom: 4px; }
    .log-entry .time { color: var(--accent); margin-right: 6px; }
    .log-entry .msg-vote { color: var(--success); }
    .log-entry .msg-create { color: var(--accent2); }

    /* Peers list */
    .peer-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 0.82rem;
    }

    .peer-item {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--muted);
    }

    .peer-icon {
      width: 28px; height: 28px;
      border-radius: 50%;
      background: var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 700;
      color: var(--accent);
    }

    /* Notification toast */
    #toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--accent);
      color: #fff;
      padding: 12px 24px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.88rem;
      transition: transform 0.35s cubic-bezier(0.4,0,0.2,1);
      z-index: 99;
    }

    #toast.show {
      transform: translateX(-50%) translateY(0);
    }
  </style>
</head>
<body>

<header>
  <h1>Poll<span>Station</span> üó≥Ô∏è <span class="badge">P2P</span></h1>
  <div class="peer-status">
    <div class="dot"></div>
    <span id="peer-count">4 peers connected</span>
  </div>
</header>

<main>

  <!-- Create Poll Card -->
  <div class="card">
    <h2><span class="icon">‚úèÔ∏è</span> Create a Poll</h2>
    <textarea id="question" placeholder="Your poll question...">What is the best Trac Network use case?</textarea>
    <div class="choices-grid">
      <input id="c1" value="DeFi Swaps" placeholder="Choice 1" />
      <input id="c2" value="P2P Messaging" placeholder="Choice 2" />
      <input id="c3" value="Timestamping" placeholder="Choice 3" />
      <input id="c4" value="Prediction Markets" placeholder="Choice 4" />
      <input id="c5" value="Agent Auctions" placeholder="Choice 5 (opt)" />
      <input id="c6" value="NFT Minting" placeholder="Choice 6 (opt)" />
    </div>
    <button class="btn-primary" onclick="createPoll()">üöÄ Broadcast Poll</button>
  </div>

  <!-- Peers Card -->
  <div class="card">
    <h2><span class="icon">üåê</span> Connected Peers</h2>
    <div class="peer-list" id="peer-list">
      <div class="peer-item"><div class="peer-icon">Y</div> <span>You (admin) ¬∑ <strong style="color:#34d68c">online</strong></span></div>
      <div class="peer-item"><div class="peer-icon">A7</div> <span>peer-a7f2... ¬∑ 12ms</span></div>
      <div class="peer-item"><div class="peer-icon">B3</div> <span>peer-b3cc... ¬∑ 28ms</span></div>
      <div class="peer-item"><div class="peer-icon">F9</div> <span>peer-f9aa... ¬∑ 45ms</span></div>
    </div>
  </div>

  <!-- Active Poll Card -->
  <div class="card poll-card" id="poll-card">
    <h2><span class="icon">üìä</span> Active Poll</h2>
    <div class="poll-question" id="poll-question">What is the best Trac Network use case?</div>

    <div id="choices-container"></div>

    <div class="vote-buttons" id="vote-buttons"></div>

    <div class="stats-row">
      <div class="stat">Total votes: <strong id="total-votes">45</strong></div>
      <div class="stat">Poll ID: <strong style="color:var(--muted);font-size:0.75rem">poll-7f3a9c</strong></div>
      <div class="stat">Status: <strong style="color:var(--success)">Open</strong></div>
    </div>
  </div>

  <!-- Activity Log Card -->
  <div class="card" style="grid-column: span 1;">
    <h2><span class="icon">üì°</span> Sidechannel Log</h2>
    <div class="log" id="log"></div>
  </div>

</main>

<div id="toast">‚úÖ Vote cast!</div>

<script>
  // --- State ---
  const state = {
    question: "What is the best Trac Network use case?",
    choices: ["DeFi Swaps", "P2P Messaging", "Timestamping", "Prediction Markets", "Agent Auctions", "NFT Minting"],
    votes: [12, 21, 8, 9, 3, 2],
    voted: null
  };

  const logMessages = [
    { time: "12:04:01", cls: "msg-create", text: "peer-a7f2 created poll poll-7f3a9c" },
    { time: "12:04:03", cls: "msg-vote", text: "peer-b3cc voted ‚Üí P2P Messaging" },
    { time: "12:04:07", cls: "msg-vote", text: "peer-f9aa voted ‚Üí DeFi Swaps" },
    { time: "12:04:12", cls: "msg-vote", text: "peer-a7f2 voted ‚Üí P2P Messaging" },
    { time: "12:04:19", cls: "msg-vote", text: "peer-b3cc voted (duplicate ‚Äî rejected)" },
    { time: "12:04:24", cls: "msg-vote", text: "5 new peers joined sidechannel" },
  ];

  // --- Render ---
  function totalVotes() {
    return state.votes.reduce((a, b) => a + b, 0);
  }

  function render() {
    const container = document.getElementById("choices-container");
    const total = totalVotes();
    container.innerHTML = state.choices.map((c, i) => {
      const pct = total > 0 ? Math.round((state.votes[i] / total) * 100) : 0;
      return `
        <div class="choice-row">
          <div class="choice-label">
            <span>${c}</span>
            <span class="pct">${pct}% (${state.votes[i]})</span>
          </div>
          <div class="bar-bg">
            <div class="bar-fill" style="width:${pct}%"></div>
          </div>
        </div>`;
    }).join('');

    const btns = document.getElementById("vote-buttons");
    btns.innerHTML = state.choices.map((c, i) =>
      `<button class="vote-btn ${state.voted === i ? 'voted' : ''}" onclick="castVote(${i})">
        ${state.voted === i ? '‚úÖ ' : ''}${c}
      </button>`
    ).join('');

    document.getElementById("total-votes").textContent = total;
  }

  function castVote(index) {
    if (state.voted !== null) { showToast("‚ö†Ô∏è Already voted!"); return; }
    state.votes[index]++;
    state.voted = index;
    render();
    addLog("now", "msg-vote", `You voted ‚Üí ${state.choices[index]}`);
    showToast(`‚úÖ Voted for: ${state.choices[index]}`);
  }

  function createPoll() {
    const q = document.getElementById("question").value.trim();
    if (!q) return;
    const choices = ['c1','c2','c3','c4','c5','c6']
      .map(id => document.getElementById(id).value.trim())
      .filter(Boolean);
    if (choices.length < 2) { showToast("‚ö†Ô∏è Need at least 2 choices"); return; }

    state.question = q;
    state.choices = choices;
    state.votes = choices.map(() => 0);
    state.voted = null;
    document.getElementById("poll-question").textContent = q;
    render();
    addLog("now", "msg-create", `You broadcast poll: "${q.substring(0,40)}..."`);
    showToast("üöÄ Poll broadcast to all peers!");
  }

  function addLog(time, cls, text) {
    const log = document.getElementById("log");
    const t = time === "now" ? new Date().toTimeString().slice(0,8) : time;
    const div = document.createElement("div");
    div.className = "log-entry";
    div.innerHTML = `<span class="time">${t}</span><span class="${cls}">${text}</span>`;
    log.prepend(div);
  }

  function showToast(msg) {
    const t = document.getElementById("toast");
    t.textContent = msg;
    t.classList.add("show");
    setTimeout(() => t.classList.remove("show"), 2500);
  }

  // Init
  render();
  logMessages.forEach(m => addLog(m.time, m.cls, m.text));

  // Simulate incoming votes
  const fakeVoters = ["peer-c1f0", "peer-d2e8", "peer-e5b3", "peer-g7k2"];
  let fakeIdx = 0;
  setInterval(() => {
    if (fakeIdx >= fakeVoters.length) return;
    const ci = Math.floor(Math.random() * state.choices.length);
    state.votes[ci]++;
    render();
    addLog("now", "msg-vote", `${fakeVoters[fakeIdx]} voted ‚Üí ${state.choices[ci]}`);
    fakeIdx++;
    document.getElementById("peer-count").textContent = `${4 + fakeIdx} peers connected`;
  }, 3500);
</script>

</body>
</html>
